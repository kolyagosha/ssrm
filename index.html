<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSRM | Scientific Stability Relationship Model</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            overflow: hidden; /* Чтобы не было прокрутки на 3D сцене */
        }
        
        /* Панель управления (слева) */
        #controls {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px;
            height: 100vh;
            background: rgba(10, 10, 10, 0.9);
            border-right: 1px solid #333;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            z-index: 10;
        }

        h1 {
            font-size: 1.2rem;
            background: -webkit-linear-gradient(0deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 20px;
            display: block;
        }

        /* Блоки слайдеров */
        .section {
            margin-bottom: 25px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #222;
        }
        
        .section h3 { margin: 0 0 10px 0; font-size: 0.9rem; text-transform: uppercase; }
        
        .control-group { margin-bottom: 10px; }
        .label-row { display: flex; justify-content: space-between; font-size: 0.8rem; color: #ccc; margin-bottom: 2px; }
        
        input[type=range] {
            width: 100%;
            -webkit-appearance: none;
            background: #333;
            height: 4px;
            border-radius: 2px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px; height: 12px;
            border-radius: 50%;
            cursor: pointer;
            background: #fff;
        }

        /* Цвета для ползунков */
        .p1 input::-webkit-slider-thumb { background: #ff4757; }
        .p2 input::-webkit-slider-thumb { background: #1e90ff; }
        .syn input::-webkit-slider-thumb { background: #ffa502; }

        /* Блок диагностики (справа сверху) */
        #diagnosis {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 250px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            text-align: right;
            z-index: 10;
        }
        
        #vol-display { font-size: 2rem; font-weight: bold; font-family: monospace; }
        #health-status { font-weight: bold; margin-top: 5px; }
        
        .healthy { color: #2ed573; }
        .warning { color: #ffa502; }
        .critical { color: #ff4757; animation: blink 1s infinite; }
        
        @keyframes blink { 50% { opacity: 0.5; } }

        /* Канвас для 3D */
        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        /* Мобильная адаптация */
        @media (max-width: 600px) {
            #controls { width: 100%; height: 40%; bottom: 0; top: auto; border-right: none; border-top: 1px solid #333; }
            #canvas-container { height: 60vh; }
        }
    </style>
</head>
<body>

    <div id="controls">
        <h1>SSRM.ONLINE</h1>
        <span class="subtitle">Dynamic Relationship Model</span>

        <div class="section p1" style="border-left: 3px solid #ff4757;">
            <h3 style="color: #ff4757;">Partner 1 (Red)</h3>
            <div class="control-group">
                <div class="label-row"><span>Resources (X)</span><span id="val-v1x">0.7</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.7" oninput="updateModel('v1', 'x', this.value)">
            </div>
            <div class="control-group">
                <div class="label-row"><span>Stability (Y)</span><span id="val-v1y">0.6</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.6" oninput="updateModel('v1', 'y', this.value)">
            </div>
            <div class="control-group">
                <div class="label-row"><span>Growth (Z)</span><span id="val-v1z">0.5</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.5" oninput="updateModel('v1', 'z', this.value)">
            </div>
        </div>

        <div class="section p2" style="border-left: 3px solid #1e90ff;">
            <h3 style="color: #1e90ff;">Partner 2 (Blue)</h3>
            <div class="control-group">
                <div class="label-row"><span>Resources (X)</span><span id="val-v2x">0.5</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.5" oninput="updateModel('v2', 'x', this.value)">
            </div>
            <div class="control-group">
                <div class="label-row"><span>Stability (Y)</span><span id="val-v2y">0.7</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.7" oninput="updateModel('v2', 'y', this.value)">
            </div>
            <div class="control-group">
                <div class="label-row"><span>Growth (Z)</span><span id="val-v2z">0.6</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.6" oninput="updateModel('v2', 'z', this.value)">
            </div>
        </div>

        <div class="section syn" style="border-left: 3px solid #ffa502;">
            <h3 style="color: #ffa502;">Synergy (Yellow)</h3>
            <div class="control-group">
                <div class="label-row"><span>Resources (X)</span><span id="val-wx">0.6</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.6" oninput="updateModel('w', 'x', this.value)">
            </div>
            <div class="control-group">
                <div class="label-row"><span>Stability (Y)</span><span id="val-wy">0.6</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.6" oninput="updateModel('w', 'y', this.value)">
            </div>
            <div class="control-group">
                <div class="label-row"><span>Growth (Z)</span><span id="val-wz">0.8</span></div>
                <input type="range" min="0" max="1" step="0.05" value="0.8" oninput="updateModel('w', 'z', this.value)">
            </div>
        </div>
        
        <p style="font-size: 0.7rem; color: #555; margin-top: 20px;">
            Based on A. Batabyal's Theory.<br>
            Developed by Hai-Guys Lab, 2025.
        </p>
    </div>

    <div id="diagnosis">
        <div style="font-size: 0.8rem; color: #aaa;">HAPPINESS VOLUME</div>
        <div id="vol-display">0.0000</div>
        <div id="health-status" class="healthy">HEALTHY</div>
        <div id="advice-text" style="font-size: 0.75rem; color: #ccc; margin-top: 10px;">System stable.</div>
    </div>

    <div id="canvas-container"></div>

    <script>
        // === 1. Инициализация данных ===
        const state = {
            v1: { x: 0.7, y: 0.6, z: 0.5 },
            v2: { x: 0.5, y: 0.7, z: 0.6 },
            w:  { x: 0.6, y: 0.6, z: 0.8 }
        };

        // === 2. Three.js Сцена ===
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(2.5, 2, 2.5);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Свет
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        // Сетка и Оси
        const gridHelper = new THREE.GridHelper(3, 30, 0x333333, 0x111111);
        scene.add(gridHelper);
        const axesHelper = new THREE.AxesHelper(1.5); // RGB = XYZ
        scene.add(axesHelper);

        // Глобальные объекты для обновления
        let tetrahedronMesh = null;
        let edgesMesh = null;
        let arrowHelpers = [];

        // === 3. Математика ===
        function calculateVolume(v1, v2, w) {
            // Cross product V1 x V2
            const cx = v1.y * v2.z - v1.z * v2.y;
            const cy = v1.z * v2.x - v1.x * v2.z;
            const cz = v1.x * v2.y - v1.y * v2.x;
            // Dot product (Cross . W)
            const dot = cx * w.x + cy * w.y + cz * w.z;
            return Math.abs(dot) / 6.0;
        }

        // === 4. Отрисовка ===
        function drawScene() {
            // Очистка старого
            if (tetrahedronMesh) scene.remove(tetrahedronMesh);
            if (edgesMesh) scene.remove(edgesMesh);
            arrowHelpers.forEach(a => scene.remove(a));
            arrowHelpers = [];

            // Вершины: Origin(0,0,0), V1, V2, W
            const vertices = [
                0, 0, 0,
                state.v1.x, state.v1.y, state.v1.z,
                state.v2.x, state.v2.y, state.v2.z,
                state.w.x,  state.w.y,  state.w.z
            ];

            // Индексы граней (треугольников)
            const indices = [
                0, 2, 1, // Base side 1
                0, 3, 2, // Base side 2
                0, 1, 3, // Base side 3
                1, 2, 3  // Cap face
            ];

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setIndex(indices);
            geometry.computeVertexNormals();

            // Цвет зависит от объема
            const vol = calculateVolume(state.v1, state.v2, state.w);
            let colorHex = 0x2ed573; // Green
            let statusText = "HEALTHY";
            let advice = "Keep maintaining balance.";
            
            if (vol < 0.025) { colorHex = 0xffa502; statusText = "WARNING"; advice = "Vectors are flattening. Differentiation needed."; }
            if (vol < 0.015) { colorHex = 0xff4757; statusText = "CRITICAL"; advice = "System collapse imminent. Start Repair Protocol."; }

            // Обновляем UI
            const volDisplay = document.getElementById('vol-display');
            volDisplay.innerText = vol.toFixed(4);
            const statusDiv = document.getElementById('health-status');
            statusDiv.innerText = statusText;
            statusDiv.className = statusText.toLowerCase();
            statusDiv.style.color = '#' + colorHex.toString(16);
            document.getElementById('advice-text').innerText = advice;

            // Меш (тело)
            const material = new THREE.MeshPhongMaterial({ 
                color: colorHex, 
                opacity: 0.4, 
                transparent: true, 
                side: THREE.DoubleSide 
            });
            tetrahedronMesh = new THREE.Mesh(geometry, material);
            scene.add(tetrahedronMesh);

            // Ребра (линии)
            const edgesGeo = new THREE.EdgesGeometry(geometry);
            const edgesMat = new THREE.LineBasicMaterial({ color: colorHex, linewidth: 2 });
            edgesMesh = new THREE.LineSegments(edgesGeo, edgesMat);
            scene.add(edgesMesh);

            // Векторы (стрелки)
            addArrow(state.v1, 0xff4757); // Red
            addArrow(state.v2, 0x1e90ff); // Blue
            addArrow(state.w,  0xffa502); // Yellow
        }

        function addArrow(vecData, color) {
            const dir = new THREE.Vector3(vecData.x, vecData.y, vecData.z);
            const len = dir.length();
            if (len === 0) return;
            const arrow = new THREE.ArrowHelper(dir.normalize(), new THREE.Vector3(0,0,0), len, color, 0.1, 0.05);
            scene.add(arrow);
            arrowHelpers.push(arrow);
        }

        // === 5. Обновление из UI ===
        window.updateModel = function(vectorName, axis, val) {
            const numVal = parseFloat(val);
            state[vectorName][axis] = numVal;
            
            // Обновить цифру рядом с ползунком
            document.getElementById(`val-${vectorName}${axis}`).innerText = numVal;
            
            // Перерисовать
            drawScene();
        };

        // === 6. Анимация (вращение) ===
        function animate() {
            requestAnimationFrame(animate);
            // Медленное вращение сцены для эффекта 3D
            scene.rotation.y += 0.002;
            renderer.render(scene, camera);
        }

        // Запуск
        drawScene();
        animate();

        // Ресайз окна
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
